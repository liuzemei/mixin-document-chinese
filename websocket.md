
## Websocket Authentication（Websocket身份验证）

Websocket可以用来接收和处理消息。以下是应该注意的事情:

1. 使用gzip压缩消息数据。
2. 必须发送LIST_PENDING_MESSAGES来接收挂起的消息。

如何连接到Websocket

```go
func ConnectMixinBlaze(token string) (*websocket.Conn, error) {
  header := make(http.Header)
  header.Add("Authorization", "Bearer "+token)
  u := url.URL{Scheme: "wss", Host: "blaze.mixin.one", Path: "/"}
  dialer := &websocket.Dialer{
    Subprotocols: []string{"Mixin-Blaze-1"},
  }
  conn, _, err := dialer.Dial(u.String(), header)  if err != nil {    return nil, err
  }  return conn, nil}
```

## Websocket Messages （Websocket消息）

以下是Websocket支持的消息类别。

#### PLAIN_TEXT
> 普通的文本消息类型
```json
{
  "id": "UUID // generated by client",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "PLAIN_TEXT",
    "status": "SENT",
    "message_id": "UUID // generated by client",
    "data": "Base64 encoded data",
  }
}
```

#### PLAIN_POST
> markdown 文章卡片类型
```json
{
  "id": "UUID // generated by client",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "PLAIN_POST",
    "status": "SENT",
    "message_id": "UUID // generated by client",
    "data": "Base64 encoded data",
  }
}
```
> 注意，这里的 data 跟 普通的文本消息类型一模一样，只不过 内容是 `markdown` 格式，不熟悉 `markdown` 语法的朋友可以忽视了。
#### PLAIN_IMAGE
> 图片消息
```json
{
  "id": "UUID",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "PLAIN_IMAGE",
    "status": "SENT",
    "message_id": "UUID",
    "data": "Base64 encoded data"
  }
}
```

#### Date Format
```json
// width: int, height: int, size: int64
{  
  "attachment_id": "Read From POST /attachments",  "mime_type": "",  
  "width": 1024,  
  "height": 1024,  
  "size": 1024,  
  "thumbnail": "base64 encoded"
}
```

#### PLAIN_DATA
> 文件消息
```json
{
  "id": "UUID",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "PLAIN_DATA",
    "status": "SENT",
    "message_id": "UUID",
    "data": "Base64 encoded data",
  }
}
```

#### Data Format
```json
// size int64
{  
  "attachment_id": "Read From POST /attachments",  
  "mime_type": "",  
  "size": 1024,  
  "name": "Share"
}
```

#### PLAIN_STICKER
> 贴纸（表情）消息（类似图片，不过不能点击放大）
```json
{
  "id":  "UUID",
  "action":  "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "PLAIN_STICKER",
    "status": "SENT",
    "message_id":  "UUID",
    "data": "Base64 encoded data"
  }
}
```
#### Data Format
```json
{  "name": "hello",  "album_id": "UUID"}
```

#### PLAIN_CONTACT
> 联系人消息
```json
{
  "id": "UUID",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "PLAIN_CONTACT",
    "status": "SENT",
    "message_id": "UUID",
    "data": "Base64 encoded data"
  }
}
```

#### Data Format
```json
{ "user_id": "UUID" }
```

#### APP_BUTTON_GROUP
> 按钮（组）消息
```json
{
  "id": "UUID",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "APP_BUTTON_GROUP",
    "status": "SENT",
    "message_id": "UUID",
    "data": "Base64 encoded data"
  }
}
```

#### Data Format

```json
[
  {
    "label": "Mixin Website",
    "color": "#ABABAB",
    "action": "https://mixin.one"
  },
  ...
]
```
> 最多 6 个按钮
#### APP_CARD
> APP卡片消息
```json
{
  "id": "UUID",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "APP_CARD",
    "status": "SENT",
    "message_id": "UUID",
    "data": "Base64 encoded data"
  }
}
```
#### Data Format
```json
{
  "icon_url": "https://mixin.one/assets/98b586edb270556d1972112bd7985e9e.png",
  "title": "Mixin",
  "description": "A free and lightning fast peer-to-peer transactional network for digital assets.",
  "action": "https://mixin.one"
}
```

#### PLAIN_VIDEO
> 视频消息
```json
{
  "id": "UUID",
  "action": "CREATE_MESSAGE",
  "params": {
    "conversation_id": "UUID",
    "category": "PLAIN_VIDEO",
    "status": "SENT",
    "message_id": "UUID",
    "data": "Base64 encoded data"
  }
}
```

#### Data Format

```json
// width: int, height: int, size: int64, duration: int64 milliseconds
{
  "attachment_id": "Read From POST /attachments",
  "mime_type": "",
  "width": 1024,
  "height": 1024,
  "size": 1024,
  "duration": 1024,
  "thumbnail": "base64 encoded"
}
```

#### `ACKNOWLEDGE_MESSAGE_RECEIPT` ack服务器接收消息
> 调用这个之后，对方客户端就会显示蓝色的双钩。
```json
{
  "id": "UUID",
  "action": "ACKNOWLEDGE_MESSAGE_RECEIPT",
  "params": {
    "message_id": "UUID // message_id is you received message's message_id",
    "status": "READ"
  }
}
```

#### `CREATE_PLAIN_MESSAGES` 发送一批消息，上限为100。

```json
{
  "id": "UUID",
  "action": "CREATE_PLAIN_MESSAGES",
  "params": {
    "messages": [
      {
        "conversation_id": "UUID",
        "recipient_id": "UUID",
        "message_id": "UUID",
        "representative_id": "UUID (optional, only supported in peer to peer conversation)",
        "quote_message_id": "UUID (optional, only supported text, e.g. PLAIN_TEXT)",
        "category": "Only support plain category e.g.: PLAIN_TEXT, PLAIN_STICKER etc",
        "data": "Correspond to category."
      },
      ...
    ]
  }
}
```

响应示例

```json
{
  "id": "89e0bdee-c355-47f2-945a-be48be875606",
    "action": "CREATE_PLAIN_MESSAGES",
    "params": "mRm5rm9bkQztvpsaTyz1Rib0BEM0S1FKl",
}
```